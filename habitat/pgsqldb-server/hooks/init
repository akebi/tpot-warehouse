#!/bin/bash -xe

# redirect stderr
exec 2>&1

# # symbolic link everything to the service var path

echo "Initialize postgresql database"
exec pg_ctl -D {{pkg.svc_path}}/pgsql/data initdb \
                   --log {{cfg.log_path}} \
                   --mode {{cfg.shutdown_mode}}
#                  -o "—-xlogdir={{cfg.wal_path}}" \
#                  "--username={{pkg.svc_user}}" \
#                  "--auth=<authmethod" \
#                  "-—auth-host=<authmethod>" \
#		           "--auth-local=<authmethod>" \
#		           "-—pwfile=" \
#                  "--locale=" \


# echo "Create postgres user that will run the db daemon"
# exec useradd -m {{pkg.svc_user}} -G {{pkg.svc_group}}
# exec sudo adduser {{pkg.svc_user}} --disabled-password
# exec sudo usermod -aG sudo {{pkg.svc_user}}
# exec su - {{pkg.svc_user}}

# echo "Create postres install directory and set permissions"
# exec mkdir -pv {{pkg.svc_data_path}}/pgsql/data && chown -Rv {{pkg.svc_user}}.{{pkg.svc_group}} {{pkg.svc_data_path}}/pgsql/data

# echo "Update postgresql.conf (database configurations)"
# exec cp -v ${pkg.svc_config_path}/postgresql.conf {{pkg.svc_data_path}}/share

# echo "Update pga_hba.conf (authorities definition)"
# exec cp -v ${pkg.svc_config_path}/pga_hba.conf {{pkg.svc_data_path}}/share
